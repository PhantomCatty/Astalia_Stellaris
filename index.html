<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astalia Stellaris | Official Archive</title>
    <!-- 引入 Google Fonts 增加设计感 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <!-- 引入 jsmediatags 用于读取 MP3 元数据 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <!-- 网站图标 favicon 设置 -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico?v=2">
    <link rel="shortcut icon" href="./favicon.ico?v=2">
    <style>
        :root {
            /* --- 核心配色：可根据你的角色配色调整 --- */
            --primary-color: #7e46ff; /* 类似蔚蓝档案的清爽蓝 */
            --accent-color: #ff88bf;  /* 强调色：粉色 */
            --text-dark: #000000;
            --text-light: #fdff9a;
            --text-standard: #e7e7e7;
            
            /* --- 玻璃容器背景 --- */
            --glass-bg: rgba(255, 255, 255, 0.3); /* 主要是白色磨砂，更适合二次元 */
            --glass-border: rgba(255, 255, 255, 0.6);
            
            /* --- 内容区域背景图设置 --- */
            /* 你可以替换这里的图片来定制内容区域的背景 */
            /* 例如: --content-bg-image: url('assets/content_bg.jpg'); */
            /* 默认使用渐变色，你可以随时切换为图片 */
            --content-bg-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* --- 你的自定义背景图在这里设置 --- */
            /* 请把你的背景图命名为 bg.jpg 放在 assets 文件夹，或者直接替换下方 url */
            /* --user-bg-image: url('assets/bg.mp4'); (已启用视频背景，请查看下方 .bg-video 样式) */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', 'Noto Sans SC', sans-serif;
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden; /* 禁止整页滚动，内容在区域内滚动 */
            background-color: #eeeeee;
        }

        /* 1. 全局背景层 */
        .bg-video {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            z-index: -2;
        }
        
        /* 半透明遮罩，防止背景太花干扰文字 */
        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(20, 100, 255, 0.1));
            /* backdrop-filter: blur(5px); 给背景一点模糊，更有高级感 */
            z-index: -1;
        }

        /* 2. 布局框架 */
        .app-container {
            display: flex;
            width: 100%;
            height: 100vh;
            padding: 0; /* 移除全局内边距，实现内容区竖向铺满 */
            padding-right: 40px; /* 右侧留白，平衡视觉 */
            gap: 40px; /* 增加侧边栏与内容区之间的间距 */
        }

        /* 3. 左侧侧边栏 (Sidebar) */
        .sidebar {
            width: 280px;
            /* 保持悬浮感，手动添加边距 */
            margin: 40px 0 40px 40px; 
            height: calc(100% - 80px);
            background: var(--glass-bg);
            border: 2px solid #fff;
            border-radius: 20px;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            z-index: 20; /* 确保侧边栏在内容之上（如果重叠） */
        }

        .logo-area {
            margin-bottom: 50px;
        }
        .logo-area h1 {
            font-size: 1.8rem;
            line-height: 1.2;
            color: var(--primary-color);
            text-transform: uppercase;
            font-weight: 700;
        }
        .logo-area span { font-size: 0.9rem; color: #888; letter-spacing: 2px; }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .nav-btn {
            padding: 15px 20px;
            border-radius: 12px;
            border: none;
            background: transparent;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-family: 'Rajdhani', sans-serif; /* 英文用科技字体 */
        }

        /* 选中/悬停状态 */
        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(93, 156, 236, 0.2);
            padding-left: 30px; /* 动效：向右移动 */
        }
        
        /* 选中时左侧的小条 */
        .nav-btn.active::before {
            content: '';
            position: absolute;
            left: 10px; top: 50%; transform: translateY(-50%);
            width: 4px; height: 16px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* 底部信息 */
        .sidebar-footer {
            margin-top: auto;
            font-size: 0.8rem;
            color: #aaa;
        }

        /* 4. 右侧内容区 (Main Content) */
        .content-window {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            /* 恢复容器白底和边框 (不裁剪) */
            background: rgba(255, 255, 255, 0.3); /* 白底，确保内容清晰 */
            /* border: 2px solid #fff; */
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        /* 内容背景层 - 梯形裁切 */
        .content-bg-layer {
            position: absolute;
            top: -200px;
            left: 0px;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }

        /* 梯形遮罩容器 (合并了背景图和渐变遮罩) */
        .trapezoid-mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* 梯形裁切路径 - 左侧倾斜 */
            clip-path: polygon(8% 15%, 100% 15%, 100% 90%, 0% 90%);
            
            /* 拆分背景属性以确保兼容性和优先级 */
            background-color: transparent;
            background-image: var(--content-bg-image, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            background-repeat: no-repeat;
            background-position: center center;
            /* 强制拉伸背景图至容器的 100% 宽和 100% 高 */
            background-size: 100% 100% !important;
            
            opacity: 1; /* 提高不透明度，让背景图清晰可见 */
            transition: background-image 0.5s ease; /* 添加背景切换过渡动画 */

        /* 使用伪元素实现渐变和模糊效果 */
        /* .trapezoid-mask::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; */
            /* 增强渐变对比度，从较不透明的白色过渡到完全透明 */
            /* background: linear-gradient(to right, 
                rgba(255,255,255,0.0) 0%, 
                rgba(255,255,255,0.0) 40%, 
                rgba(255,255,255,0.0) 100%); */
            /* backdrop-filter: blur(3px); 轻微模糊背景图 */
            /* pointer-events: none; */        
            /* 使用 mask 实现背景图本身的透明度渐变 */
            -webkit-mask-image: linear-gradient(to left, black 0%, black 40%, transparent 100%);
            mask-image: linear-gradient(to left, black 0%, black 40%, transparent 100%);
        }

        /* 装饰边框 - 跟随梯形 */
        .content-border {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            clip-path: polygon(8% 0%, 100% 0%, 100% 100%, 0% 100%);
            border: 2px solid rgba(126, 70, 255, 0.3);
            pointer-events: none;
            z-index: 3;
        }

        /* 页面切换动画容器 */
        .page-section {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: 700px 60px 50px 80px; /* 顶部增加空屏区域 */
            opacity: 0;
            transform: translateX(30px);
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            pointer-events: none;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 5; /* 确保在所有背景层之上 */
        }

        .page-section.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            z-index: 10;
        }

        /* 自定义滚动条 */
        .page-section::-webkit-scrollbar {
            width: 8px;
        }
        .page-section::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
        }
        .page-section::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        .page-section::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        /* ---------------- 各个页面的特定样式 ---------------- */

        /* 首页：大立绘展示 */
        #home-page {
            display: flex;
            align-items: center;
            justify-content: space-between;
            overflow: hidden; /* 首页不滚动 */
        }
        .home-text {
            max-width: 45%;
            z-index: 2;
        }
        .home-text h2 { font-size: 3.5rem; color: var(--primary-color); margin-bottom: 20px; line-height: 1; }
        .home-text p { font-size: 1.2rem; color: var(--accent-color); margin-bottom: 30px; line-height: 1.6; }
        
        .tachie-container {
            position: absolute;
            right: -5%; top: 5%; bottom: -5%;
            width: 60%;
            background: url('assets/char_tachie.png') no-repeat center bottom;
            background-size: contain;
            /* 如果没有图片，用这个占位符显示效果 */
            /* background-color: rgba(93, 156, 236, 0.1); */
            z-index: 5;
            filter: drop-shadow(-10px 0 20px rgba(0,0,0,0.1));
            /* 呼吸动效 */
            /* animation: breathe 4s ease-in-out infinite; */
        }
        .sprite-variations-container1 {
            position: absolute;
            right: 5%; top: 5%; bottom: 70%;
            width: 10%;
            background: url('assets/sprite_variations1.png') no-repeat center bottom;
            background-size: contain;
            /* 如果没有图片，用这个占位符显示效果 */
            /* background-color: rgba(93, 156, 236, 0.1); */
            z-index: 1;
            filter: drop-shadow(-10px 0 20px rgba(0,0,0,0.1));
            /* 呼吸动效 */
            /* animation: breathe 4s ease-in-out infinite; */
        }
        .sprite-variations-container2 {
            position: absolute;
            right: 5%; top: 5%; bottom: 52%;
            width: 10%;
            background: url('assets/sprite_variations2.png') no-repeat center bottom;
            background-size: contain;
            /* 如果没有图片，用这个占位符显示效果 */
            /* background-color: rgba(93, 156, 236, 0.1); */
            z-index: 1;
            filter: drop-shadow(-10px 0 20px rgba(0,0,0,0.1));
            /* 呼吸动效 */
            /* animation: breathe 4s ease-in-out infinite; */
        }
        .sprite-variations-container3 {
            position: absolute;
            right: 5%; top: 5%; bottom: 34%;
            width: 10%;
            background: url('assets/sprite_variations3.png') no-repeat center bottom;
            background-size: contain;
            /* 如果没有图片，用这个占位符显示效果 */
            /* background-color: rgba(93, 156, 236, 0.1); */
            z-index: 1;
            filter: drop-shadow(-10px 0 20px rgba(0,0,0,0.1));
            /* 呼吸动效 */
            /* animation: breathe 4s ease-in-out infinite; */
        }

        /* 装饰圆环 */
        .decor-circle {
            position: absolute;
            right: 10%; bottom: 10%;
            width: 500px; height: 500px;
            border: 2px dashed rgba(93, 156, 236, 0.3);
            border-radius: 50%;
            animation: spin 30s linear infinite;
            z-index: 0;
        }

        /* 内页通用排版 */
        .page-header {
            border-bottom: 2px solid rgba(0,0,0,0.05);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .page-header h2 { font-size: 2.5rem; color: var(--text-dark); }
        .page-header span { color: var(--accent-color); font-weight: bold; letter-spacing: 2px; }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        /* 资产卡片 */
        .asset-card {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            cursor: pointer;
            /* 修复图片浮于容器上方的问题，确保圆角裁剪生效 */
            transform: translateZ(0); 
            position: relative;
            z-index: 1;
        }
        .asset-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(93, 156, 236, 0.2); }
        .card-media {
            /* height: 200px;  移除固定高度，改用宽高比 */
            width: 100%;
            aspect-ratio: 16/9; /* 确保四宫格能展示出第二行 */
            background-color: #ddd;
            display: block; /* 改为 block 以便支持滚动 */
            color: #888;
            overflow-y: auto; /* 允许垂直滚动查看长图 */
            overflow-x: hidden;
            position: relative;
        }
        /* 美化卡片内部滚动条 */
        .card-media::-webkit-scrollbar { width: 4px; }
        .card-media::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .card-media::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 2px; }

        .card-media img, .card-media video { 
            width: 100%; 
            height: auto; /* 高度自适应，长图可滚动 */
            min-height: 100%; /* 宽图至少填满容器 */
            object-fit: cover; 
            object-position: top; 
            display: block;
        }
        
        /* --- 2x2 Grid for Asset Card --- */
        .media-grid-2x2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            width: 100%;
            height: 100%;
        }

        /* --- 2x1 Grid for Asset Card --- */
        .media-grid-2x1 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr;
            width: 100%;
            height: 100%;
        }

        .media-grid-2x2 img, .media-grid-2x1 img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            cursor: zoom-in;
            transition: opacity 0.2s;
        }
        .media-grid-2x2 img:hover, .media-grid-2x1 img:hover {
            opacity: 0.9;
            z-index: 1; /* Ensure hover effect is on top if needed */
        }

        .card-info { padding: 20px; }
        .card-info h3 { font-size: 1.2rem; margin-bottom: 8px; color: var(--text-dark); }
        .card-info p { font-size: 0.9rem; color: #888; }

        /* --- 新增模块化布局样式 --- */
        .content-module {
            display: flex;
            gap: 40px;
            margin-bottom: 60px; /* 模块间距 */
            align-items: flex-start;
        }

        .module-header {
            flex: 0 0 240px; /* 左侧固定宽度 */
            position: sticky;
            top: 20px;
        }

        .module-header h3 {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-color);
            padding-left: 12px;
            line-height: 1.3;
        }

        .module-header p {
            font-size: 0.95rem;
            color: var(--text-standard);
            line-height: 1.6;
            text-align: justify;
        }

        .module-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr; /* 限制最多两列 */
            gap: 25px;
        }

        /* 动画定义 */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 移动端适配 */
        @media (max-width: 900px) {
            .app-container { flex-direction: column; padding: 0; height: auto; }
            .sidebar { width: 100%; height: auto; border-radius: 0; padding: 20px; }
            .nav-menu { flex-direction: row; overflow-x: auto; }
            .content-window { height: 80vh; }
            .trapezoid-mask { clip-path: none; } /* 移动端取消梯形裁切 */
            .content-border { clip-path: none; border: none; }
            .page-section { padding: 30px 20px; }
            .tachie-container { opacity: 0.2; right: -20%; }
            
            /* 模块化布局移动端适配 */
            .content-module { flex-direction: column; gap: 20px; margin-bottom: 40px; }
            .module-header { width: 100%; flex: none; margin-bottom: 10px; position: static; }
            .module-content { grid-template-columns: 1fr; } /* 移动端改为单列 */
            
            /* 音乐播放器移动端适配 */
            .player-layout { flex-direction: column !important; }
            .player-left { margin-bottom: 20px; width: 100%; }
        }

        /* --- 音乐播放器模块样式 --- */
        .player-layout {
            display: flex;
            flex-direction: row;
            gap: 30px;
            background: rgba(255, 255, 255, 0.5);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.6);
        }

        .player-left {
            flex: 0 0 240px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .vinyl-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 25px;
            flex-shrink: 0;
        }

        /* 黑胶唱片本体 */
        .vinyl-disc {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            /* 模拟黑胶纹理 */
            background: repeating-radial-gradient(
              #181818,
              #181818 2px,
              #282828 3px,
              #282828 4px
            );
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin 6s linear infinite;
            animation-play-state: paused; /* 默认暂停 */
            border: 4px solid #000;
        }

        .vinyl-disc.playing {
            animation-play-state: running;
        }

        /* 唱片封面 (圆形裁切) */
        .vinyl-cover {
            width: 65%;
            height: 65%;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            border: 3px solid #fff;
            background-color: #ddd;
            position: relative;
        }
        /* 唱片中心孔 */
        .vinyl-cover::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 12px; height: 12px;
            background: #000;
            border-radius: 50%;
        }

        /* 播放按钮 (悬浮在唱片中心) */
        .play-control-btn {
            position: absolute;
            top: 90%; left: 10%;
            transform: translate(-50%, -50%);
            width: 46px; height: 46px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: 2px solid #fff;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.9;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(126, 70, 255, 0.4);
        }
        .play-control-btn:hover { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }

        .current-song-info { width: 100%; text-align: left; }
        .current-song-info h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 1.2rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
        }
        .current-song-info span {
            display: block;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 2px;
        }
        .album-tag {
            font-size: 0.8rem !important;
            color: var(--accent-color) !important;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 8px !important;
        }

        .player-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
        }

        .playlist {
            flex: 1;
            overflow-y: auto;
            max-height: 220px;
            padding-right: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 10px;
        }

        .playlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        .playlist-item:hover {
            background: rgba(255,255,255,0.8);
            padding-left: 20px;
        }
        .playlist-item.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 10px rgba(126, 70, 255, 0.3);
        }
        .playlist-item.active span { color: white; }
        
        /* 正在播放的动画图标 */
        .playing-icon {
            display: none;
            font-size: 0.8rem;
        }
        .playlist-item.active .playing-icon { display: block; }

        .song-description-box {
            background: rgba(255,255,255,0.6);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #555;
            border-left: 4px solid var(--accent-color);
            line-height: 1.6;
        }
        .song-description-box h5 {
            margin-bottom: 5px;
            color: var(--text-dark);
            font-size: 0.85rem;
            opacity: 0.7;
            text-transform: uppercase;
        }

        /* 滚动条美化 */
        .playlist::-webkit-scrollbar { width: 6px; }
        .playlist::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 3px; }
        .playlist::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        .playlist::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* --- Loading Screen 样式 --- */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #eeeeee;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-out;
        }

        .loading-content {
            text-align: center;
            width: 80%;
            max-width: 400px;
        }

        .loading-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .progress-container {
            width: 100%;
            height: 4px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.2s ease;
            box-shadow: 0 0 10px rgba(126, 70, 255, 0.5);
        }

        .loading-text {
            margin-top: 15px;
            font-family: 'Rajdhani', sans-serif;
            color: #888;
            font-size: 1rem;
            letter-spacing: 2px;
        }

        /* --- Lightbox (大图查看) 样式 --- */
        .lightbox-modal {
            display: none; /* 默认隐藏 */
            position: fixed;
            z-index: 2000; /* 确保在最上层 */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); /* 深色背景 */
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            animation: zoomIn 0.3s ease;
            cursor: zoom-in;
            /* 移除 transition 以保证拖拽流畅，或者只对非 transform 属性做过渡 */
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            z-index: 2001;
            line-height: 1;
        }
        .lightbox-close:hover { color: var(--primary-color); }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-title">ASTALIA STELLARIS</div>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <div class="loading-text">INITIALIZING SYSTEM... 0%</div>
        </div>
    </div>

    <!-- 1. 背景层 -->
    <video class="bg-video" autoplay loop muted playsinline>
        <source src="assets/bg.mp4" type="video/mp4">
    </video>
    <div class="bg-overlay"></div>

    <div class="app-container">
        
        <!-- 2. 左侧导航栏 -->
        <nav class="sidebar">
            <div class="logo-area">
                <h1>Astalia<br>Stellaris</h1>
                <span>PROJECT ARCHIVE</span>
            </div>
            
            <div class="nav-menu">
                <!-- onclick 切换页面的核心逻辑 -->
                <!-- data-bg 属性用于配置该栏目的背景图，可使用 url('...') 或 渐变色 -->
                <button class="nav-btn active" 
                        onclick="switchPage('home-page', this)"
                        data-bg="url('assets/bg_home.png')">
                    00_首页 / HOME
                </button>
                <button class="nav-btn" 
                        onclick="switchPage('origin-page', this)"
                        data-bg="url('assets/bg_origin.png')">
                    01_起源 / ORIGIN
                </button>
                <button class="nav-btn" 
                        onclick="switchPage('avatar-page', this)"
                        data-bg="url('assets/bg_avatar.png')">
                    02_化身 / AVATAR
                </button>
                <button class="nav-btn" 
                        onclick="switchPage('tech-page', this)"
                        data-bg="url('assets/bg_tech.png')">
                    03_技术 / TECH
                </button>
                <button class="nav-btn" 
                        onclick="switchPage('world-page', this)"
                        data-bg="url('assets/bg_world.png')">
                    04_世界 / WORLD
                </button>
            </div>

            <div class="sidebar-footer">
                <p>Powered by Zhenming Duan</p>
            </div>
        </nav>

        <!-- 3. 右侧内容窗口 -->
        <main class="content-window">
            <!-- 背景层结构 -->
            <div class="content-bg-layer">
                <div class="trapezoid-mask"></div>
            </div>
            <div class="content-border"></div>
            
            <!-- A. 首页 (HOME) -->
            <section id="home-page" class="page-section active">
                <div class="decor-circle"></div>
                
                <div class="home-text">
                    <h2>VIRTUAL<br>IDENTITY</h2>
                    <p>“并不是所有人都有能力得到爱，但人人都有资格拥有爱。”</p>
                    <p style="font-size: 0.9rem; color: var(--text-standard);">
                        一个始于社区危机的虚拟救赎实验。<br>
                        融合实时变声、Live2D表演与3D交互的跨媒介叙事。<br>
                        Produced by Zhenming Duan
                    </p>
                    <button onclick="window.open('assets/Design_document.pdf', '_blank')" style="padding: 12px 30px; background: var(--primary-color); color: white; border:none; border-radius: 25px; cursor: pointer; font-weight: bold;">
                        View Design Statement
                    </button>
                </div>

                <!-- 你的角色立绘 (请替换图片 assets/char_tachie.png) -->
                <div class="tachie-container"></div>
                
                <!-- 差分立绘展示 -->
                <div class="sprite-variations-container1"></div>
                <div class="sprite-variations-container2"></div>
                <div class="sprite-variations-container3"></div>
            </section>

            <!-- B. 起源 (ORIGIN) -->
            <section id="origin-page" class="page-section">
                <div class="page-header">
                    <span>CHAPTER 01</span>
                    <h2>起源与概念 / Origin</h2>
                </div>
                
                <div class="content-module">
                    <div class="module-header">
                        <h3>项目背景</h3>
                        <p>项目起源于2024年4月的一场社区情感危机。基于对玩家群体“情感代偿”机制的民族志观察，我构思了这个角色。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <!-- 示例图片 -->
                                <img src="assets/origin_01.png" alt="Crisis Analysis">
                            </div>
                            <div class="card-info">
                                <h3>当日官方公告</h3>
                                <p>约有5w条抗议评论被官方删除。在发布当日，抗议的评论数量高达22w条。</p>
                            </div>
                        </div>
                        <div class="asset-card">
                            <div class="card-media">
                                <img src="assets/origin_02.png" alt="Concept Draft">
                            </div>
                            <div class="card-info">
                                <h3>玩家发声</h3>
                                <p>图中记录了一名玩家表示为什么会感到如此愤怒和失望，而这也是我注意到玩家门在这款游戏上寄托巨大情感依赖的开端。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>早期立项</h3>
                        <p>基于我所在的社区理念和反抗的源头《Blue Archive》，我进行了外显层和内涵层设计。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card" style="grid-column: 1 / -1;">
                            <div class="card-media">
                                <!-- 示例图片 -->
                                <img src="assets/origin_03.png" alt="Crisis Analysis">
                            </div>
                            <div class="card-info">
                                <p>外显层上，使用了光环和少女的相似概念，但选用细腻且具有光泽感的画风、传统日系幻想元素、
                                    逆性张力的垂眼角和相对暴露的着装作为主要元素，使角色在视觉感官上处于碧蓝档案的逆位。
                                </p>
                                <p>内涵层上，基于玩家经历的情感破坏、我对游戏厂商和玩家的关系的思考、和我情感依赖的探求，
                                    设计了"因魔王毁灭家乡而流离失所的少女，背负不属于她的期盼寻找爱"的故事。<br>
                                </p>
                                <button onclick="window.open('assets/Commission_document.pdf', '_blank')" style="padding: 10px 25px; background: var(--primary-color); color: white; border:none; border-radius: 25px; cursor: pointer; font-weight: bold;">
                                View Commission Document
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- C. 化身 (AVATAR) -->
            <section id="avatar-page" class="page-section">
                <div class="page-header">
                    <span>CHAPTER 02</span>
                    <h2>数字肉身 / Avatar</h2>
                </div>
                
                <div class="content-module">
                    <div class="module-header">
                        <h3>角色展示</h3>
                        <p>包含角色视觉外观、情感差分立绘以及背景信息的宣传视频。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card" style="grid-column: 1 / -1;">
                            <div class="card-media" style="height: 400px;">
                                <!-- 视频位 -->
                                <video class="interactive-video" src="assets/PV.mp4" controls></video>
                                <!-- <div style="text-align:center;">直播切片演示视频 (Project Reel)</div> -->
                            </div>
                            <div class="card-info">
                                <h3>Character Showcase</h3>
                                <p>A promotional video featuring the character’s visual appearance, emotional sprite variations, and background information.<br>
                                    - Illustrator: 怠DiE(DaiDie)<br>
                                    - Modeler: 小路姬_Ibuki<br>
                                    - Video Production: Astalia_Stellaris(Zhenming Duan)<br>
                                    - BGM: A Guiding Star by Elliot Hsu
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>实时演出</h3>
                        <p>展示 RVC 实时变声效果的直播切片演示。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card" style="grid-column: 1 / -1;">
                            <div class="card-media" style="height: 400px;">
                                <!-- 视频位 -->
                                <iframe id="youtube-player" width="100%" height="100%" src="https://www.youtube.com/embed/UsMDVWR4Edk?enablejsapi=1" title="Forget You Not" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                                <!-- <div style="text-align:center;">直播切片演示视频 (Project Reel)</div> -->
                            </div>
                            <div class="card-info">
                                <h3>Live Performance Reel</h3>
                                <p>A showcase of RVC real-time voice changing effects.<br>
                                    -Original Song: Toki wa Itoshiki Mono o Nosete ~Forget You Not~<br>
                                    -Original Singer: Madoka Yonezawa
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>宣发物料</h3>
                        <p>展示我作为vtuber运营，为了运营活动和丰富角色形象而制作的资产</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <video class="interactive-video" src="assets/asset1.mp4" controls></video>
                            </div>
                            <div class="card-info">
                                <h3>MHWild 角色替换mod</h3>
                                <p>使用koikatsu制作塔塔的简易模型，并通过blender和开源的re toolbox、re mdf插件制作怪物猎人：荒野的角色替换mod。</p>
                            </div>
                        </div>
                        <div class="asset-card">
                            <div class="card-media">
                                <div class="media-grid-2x2">
                                    <!-- 示例图片，请替换为你需要的 png/gif -->
                                    <img src="assets/asset2.png" alt="Image 1" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/asset3.gif" alt="Image 2" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/asset4.png" alt="Image 3" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/asset5.png" alt="Image 4" onclick="event.stopPropagation(); openLightbox(this.src)">
                                </div>
                            </div>
                            <div class="card-info">
                                <h3>memes</h3>
                                <p>我使用ps描改的表情包和签名等等小物件</p>
                            </div>
                        </div>
                        <div class="asset-card">
                            <div class="card-media">
                                <img src="assets/asset6.png" alt="ComfyUI Workflow">
                            </div>
                            <div class="card-info">
                                <h3>角色宣传图</h3>
                                <p>基于comfyui，使用多种ckpt模型配合我训练的lora模型制作塔塔的宣传图。对于需要精修的细节，我通过ps亲手修复而非使用inpaint，因为这是质量更高的选择。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- D. 技术 (TECH) -->
            <section id="tech-page" class="page-section">
                <div class="page-header">
                    <span>CHAPTER 03</span>
                    <h2>技术栈 / Tech Stack</h2>
                </div>
                
                <div class="content-module">
                    <div class="module-header">
                        <h3>3d角色建模</h3>
                        <p>基于原画师的拆分立绘，使用blender为角色制作3d模型。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <div class="media-grid-2x2">
                                    <!-- 示例图片，请替换为你需要的 png/gif -->
                                    <img src="assets/model1.png" alt="Image 1" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/model2.png" alt="Image 2" onclick="event.stopPropagation(); openLightbox(this.src)">
                                </div>
                            </div>
                            <div class="card-info">
                                <p>为了让角色在3d场景下表现更佳，我学习了一些知名的vrchat模型并对原画的脸型和眼型进行少量修改。<br>
                                    这里再补几张动捕的图凑够四张</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>RVC实时变声管线</h3>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <div class="media-grid-2x1">
                                    <!-- 示例图片，请替换为你需要的 png/gif -->
                                    <img src="assets/rvc1.png" alt="Image 1" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/rvc2.png" alt="Image 2" onclick="event.stopPropagation(); openLightbox(this.src)">
                                </div>
                            </div>
                            <div class="card-info">
                                <p>Using Studio One 6 as digital audio workstation for real-time voice conversion pipeline.</p>
                            </div>
                        </div>
                        
                        <div class="asset-card">
                            <div class="card-media" style="height: 400px;">
                                <!-- 视频位 -->
                                <video class="interactive-video" src="assets/MHWildED.mp4" controls></video>
                                <!-- <div style="text-align:center;">直播切片演示视频 (Project Reel)</div> -->
                            </div>
                            <div class="card-info">
                                <h3>调音效果展示</h3>
                                <p>同时使用DAW和RVC进行录制和音频后期处理</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>Unity NPR渲染</h3>
                        <p>使用 LilToon 着色器实现光泽感强的卡通质感。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <div class="media-grid-2x2">
                                    <!-- 示例图片，请替换为你需要的 png/gif -->
                                    <img src="assets/unity1.png" alt="Image 1" onclick="event.stopPropagation(); openLightbox(this.src)">
                                    <img src="assets/unity2.png" alt="Image 2" onclick="event.stopPropagation(); openLightbox(this.src)">
                                </div>
                            </div>
                            <div class="card-info">
                                <p>渲染图由unity直出，无外部工具处理</p>
                            </div>
                        </div>
                        <div class="asset-card">
                            <div class="card-media" style="height: 400px;">
                                <!-- 视频位 -->
                                <video class="interactive-video" src="assets/unity3.mp4" controls></video>
                                <!-- <div style="text-align:center;">直播切片演示视频 (Project Reel)</div> -->
                            </div>
                            <div class="card-info">
                                <h3>Unity NPR 渲染</h3>
                                <p>使用 LilToon 着色器实现的仿手绘质感。<br>
                                视频由unity直出，无外部工具处理</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-module">
                    <div class="module-header">
                        <h3>AIGC工作流</h3>
                        <p>基于 SDXL 的 LoRA 训练与 ComfyUI 节点图。</p>
                    </div>
                    <div class="module-content">
                        <div class="asset-card">
                            <div class="card-media">
                                <img src="assets/ai1.png" alt="ComfyUI Workflow">
                            </div>
                            <div class="card-info">
                                <h3>AI 辅助工作流</h3>
                                <p>使用模型：<br>
                                -noobaiXLNAIXL_epsilonPred11</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- E. 世界 (WORLD) -->
            <section id="world-page" class="page-section">
                <div class="page-header">
                    <span>CHAPTER 04</span>
                    <h2>世界观 / World Building</h2>
                </div>
                
                <div class="content-module" style="flex-direction: column;">
                    <div class="module-header" style="width: 100%; flex: none; position: static; margin-bottom: 20px;">
                        <h3>世界架构</h3>
                        <p>故事的世界观由Astalia的家乡和另一个世界线的现代地球组成，星海中的双子行星luciarion&nyxarion孕育了包括塔塔在内的星裔，在魔王毁灭luciarion以后，塔塔承载着期盼逃亡到地球。这个世界观下的地球，ai技术领先于其它科技，然而ai智能体的物理化还在研究阶段。塔塔来到地球以后，由于各种机缘巧合与一个实验性的ai智能体机器人共处一室，两个非人类的生物将在人类的世界里相互依靠，探寻爱的意义。</p>
                    </div>
                    <div class="module-content" style="width: 100%;">
                        <div class="asset-card">
                            <div class="card-media">
                                <img src="assets/world_map.jpg" alt="Lore Map">
                            </div>
                            <div class="card-info">
                                <h3>星塔世界全图</h3>
                                <p>未完成的叙事宇宙架构与势力分布。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 新增：音乐播放器模块 -->
                <div class="content-module" id="music-module">
                    <div class="module-header">
                        <h3>原声音乐 / OST</h3>
                        <p>收录企划相关的原创音乐与印象曲目。<br>点击右侧列表切换歌曲。</p>
                    </div>
                    <div class="module-content player-layout">
                        <!-- 左侧：黑胶唱片与信息 -->
                        <div class="player-left">
                            <div class="vinyl-wrapper">
                                <div class="vinyl-disc" id="vinylDisc">
                                    <div class="vinyl-cover" id="vinylCover"></div>
                                </div>
                                <button class="play-control-btn" id="playPauseBtn" onclick="togglePlay()">
                                    ▶
                                </button>
                            </div>
                            <div class="current-song-info">
                                <h4 id="currentTitle">Song Title</h4>
                                <span id="currentArtist">Artist Name</span>
                                <span id="currentAlbum" class="album-tag">ALBUM NAME</span>
                            </div>
                        </div>

                        <!-- 右侧：歌单与描述 -->
                        <div class="player-right">
                            <div class="playlist" id="playlist">
                                <!-- JS 生成列表项 -->
                            </div>
                            <div class="song-description-box">
                                <!-- <h5>Track Description</h5> -->
                                <p id="currentDesc">正在加载歌曲信息...</p>
                            </div>
                        </div>
                        
                        <!-- 隐藏的音频元素 -->
                        <audio id="audioPlayer" onended="playNext()"></audio>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Lightbox Modal 结构 -->
    <div id="imageLightbox" class="lightbox-modal" onclick="if(event.target === this) closeLightbox()">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightboxImage">
    </div>

    <script src="elements.js"></script>
    
    <script>
        // --- Loading Screen Logic ---
        document.addEventListener("DOMContentLoaded", function() {
            const loadingScreen = document.getElementById('loading-screen');
            const progressBar = document.querySelector('.progress-bar');
            const loadingText = document.querySelector('.loading-text');
            
            // 获取页面上所有的图片和视频
            // 优先关注背景视频和其他大资源
            const videos = Array.from(document.querySelectorAll('video'));
            const images = Array.from(document.querySelectorAll('img'));
            
            // 手动添加需要预加载的 CSS 背景图 (关键的大图，如立绘)
            // 这样可以防止进入页面后立绘还在闪烁加载
            const cssBackgrounds = [
                'assets/char_tachie.png',
                'assets/sprite_variations1.png',
                'assets/sprite_variations2.png',
                'assets/sprite_variations3.png'
            ];
            
            const preloadImages = cssBackgrounds.map(src => {
                const img = new Image();
                img.src = src;
                return img;
            });

            // 合并资源列表
            const assets = [...videos, ...images, ...preloadImages];
            let total = assets.length;
            let loaded = 0;

            // 如果没有资源，直接结束
            if (total === 0) {
                finishLoading();
                return;
            }

            // 更新进度条
            function updateProgress() {
                loaded++;
                const percent = Math.floor((loaded / total) * 100);
                
                if (progressBar) progressBar.style.width = percent + '%';
                if (loadingText) loadingText.innerText = `INITIALIZING SYSTEM... ${percent}%`;
                
                if (loaded >= total) {
                    // 全部加载完成，稍微延迟一下让用户看到100%
                    setTimeout(finishLoading, 500);
                }
            }

            // 结束加载，隐藏遮罩
            function finishLoading() {
                if (!loadingScreen) return;
                loadingScreen.style.opacity = '0';
                // 等待淡出动画结束后移除元素 (display: none)
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    
                    // 尝试自动播放背景视频（如果被浏览器策略阻止，这里可能需要用户交互）
                    const bgVideo = document.querySelector('.bg-video');
                    if (bgVideo && bgVideo.paused) {
                        bgVideo.play().catch(e => console.log("Background video autoplay blocked:", e));
                    }
                }, 500);
            }

            // 为每个资源添加加载监听
            assets.forEach(asset => {
                if (asset.tagName === 'IMG') {
                    if (asset.complete) {
                        updateProgress();
                    } else {
                        asset.addEventListener('load', updateProgress);
                        asset.addEventListener('error', updateProgress); // 加载失败也算完成，避免卡死
                    }
                } else if (asset.tagName === 'VIDEO') {
                    // 对于视频，readyState >= 3 (HAVE_FUTURE_DATA) 通常足以开始播放
                    // 或者使用 'loadeddata' 事件表示首帧已加载
                    if (asset.readyState >= 3) {
                        updateProgress();
                    } else {
                        // 使用 loadeddata 确保至少加载了第一帧
                        asset.addEventListener('loadeddata', updateProgress);
                        asset.addEventListener('error', updateProgress);
                    }
                }
            });

            // 安全兜底：如果10秒内没加载完（比如网络卡顿或资源挂了），强制进入页面
            setTimeout(() => {
                if (loadingScreen && loadingScreen.style.display !== 'none') {
                    console.warn("Loading timed out, forcing entry.");
                    finishLoading();
                }
            }, 10000); // 10秒超时
        });
    </script>
</body>
</html>